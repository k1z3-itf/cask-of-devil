(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{272:function(e,t,n){"use strict";n.r(t),n.d(t,"ARmod",(function(){return h}));var r=n(114),o=n(115),c=(n(36),n(57),n(243)),h=function(){function e(){Object(r.a)(this,e),this.title="untitled",this.scale=30,this.maxScale=100,this.minScale=5,this.stepScale=5,this.mixers=[]}return Object(o.a)(e,[{key:"setARForm",value:function(e){this.arForm=e}},{key:"setScene",value:function(){this.clock=new c.k,this.scene=new c.fb,this.totalTime=0,this.renderer=new c.sb({canvas:document.querySelector("#iz-arkit-threejs"),antialias:!0,alpha:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(new c.l("lightgrey"),0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.outputEncoding=c.q;this.markerRoot=new c.r,this.markerRoot.name="marker",this.scene.add(this.markerRoot)}},{key:"getCanvasRelativePosition",value:function(e){var t,n,rect=document.getElementById("iz-arkit-threejs").getBoundingClientRect(),r=parseInt(document.getElementById("iz-arkit-threejs").style.width,10),o=parseInt(document.getElementById("iz-arkit-threejs").style.height,10);return e instanceof MouseEvent?(t=(e.clientX-rect.left)*r/rect.width,n=(e.clientY-rect.top)*o/rect.height):e instanceof TouchEvent&&(t=(e.changedTouches[0].pageX-rect.left)*r/rect.width,n=(e.changedTouches[0].pageY-rect.top)*o/rect.height),[t,n]}},{key:"setLight",value:function(){var e=new c.X(16777215,1);e.position.set(-25,0,-20),this.scene.add(e),(e=new c.X(16777215,1)).position.set(25,0,-20),this.scene.add(e),(e=new c.X(16777215,1)).position.set(0,0,23.25),this.scene.add(e),(e=new c.X(16777215,1)).position.set(0,20.4,-20),this.scene.add(e)}},{key:"setCamera",value:function(){var e=this;this.camera=new c.W,this.scene.add(this.camera),this.arToolkitContext=new THREEx.ArToolkitContext({cameraParametersUrl:"/cask-of-devil/camera_para.dat"}),this.arToolkitContext.init((function(){e.camera.projectionMatrix.copy(e.arToolkitContext.getProjectionMatrix())})),this.arToolkitSource=new THREEx.ArToolkitSource({sourceType:"webcam"}),this.arToolkitSource.init((function(){var e=0,t=setInterval((function(){++e>20&&clearInterval(t),n()}),100)}));var t=this;function n(){t.arToolkitSource.onResizeElement(),t.arToolkitSource.copyElementSizeTo(t.renderer.domElement),null!==t.arToolkitContext.arController&&t.arToolkitSource.copyElementSizeTo(t.arToolkitContext.arController.canvas)}window.addEventListener("resize",(function(){n()}));new THREEx.ArMarkerControls(this.arToolkitContext,this.markerRoot,{type:"pattern",patternUrl:"/cask-of-devil/3Dmarker/hiro.patt",changeMatrixMode:"modelViewMatrix"})}},{key:"setObject",value:function(){}},{key:"setSysObject",value:function(){var e=new c.f(1,1,1),t=new c.M;this.calcCube=new c.K(e,t),this.calcCube.scale.set(0,0,0),this.markerRoot.add(this.calcCube)}},{key:"setEvent",value:function(){}},{key:"update",value:function(){this.arToolkitSource.ready&&this.arToolkitContext.update(this.arToolkitSource.domElement)}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"animate",value:function(){requestAnimationFrame(this.animate.bind(this));var e=this.clock.getDelta();this.totalTime+=this.clock.getDelta(),this.update(),this.render();for(var i=0;i<this.mixers.length;i++)this.mixers[i].update(e)}},{key:"world2screenPos",value:function(e,t,n){this.calcCube.position.set(e,t,n);var r=parseInt(document.getElementById("iz-arkit-threejs").style.width,10),o=parseInt(document.getElementById("iz-arkit-threejs").style.height,10),h=this.calcCube.getWorldPosition(new c.qb).project(this.camera),rect=document.getElementById("iz-arkit-threejs").getBoundingClientRect(),l=r*(h.x+1)/2,d=o*(1-h.y)/2;return{x:l=l*rect.width/r+rect.left,y:d=d*rect.height/o+rect.top}}},{key:"screen2worldPos",value:function(e){var t=parseInt(document.getElementById("iz-arkit-threejs").style.width,10),n=parseInt(document.getElementById("iz-arkit-threejs").style.height,10),r=this.getCanvasRelativePosition(e),o=1.08*(r[0]/t*2-1),h=.81*(-r[1]/n*2+1);return o=Math.min(Math.max(o,-1),1),h=Math.min(Math.max(h,-1),1),new c.pb(o,h)}},{key:"getObjName",value:function(e){var t=this.screen2worldPos(e),n="",r=new c.db;r.setFromCamera(t,this.camera);for(var o,h=r.intersectObjects(this.scene.children,!0),i=0;i<h.length;i++){for(var l=(o=h[i].object).name;o.parent.name!==this.markerRoot.name;)o=o.parent;if(1==o.visible){n=l;break}}return n}},{key:"getThreeObjName",value:function(e){var t=this.screen2worldPos(e),n="",r=new c.db;r.setFromCamera(t,this.camera);for(var o,h=r.intersectObjects(this.scene.children,!0),i=0;i<h.length;i++){for(o=h[i].object;o.parent.name!==this.markerRoot.name;)o=o.parent;if(1==o.visible){n=o.name;break}}return n}},{key:"initRotate",value:function(){var e=document.getElementById("display-rotate");e.width=window.innerWidth,e.height=window.innerHeight}},{key:"act_zoomIn",value:function(){if(this.scale<this.maxScale){this.scale;this.scale=this.scale>=this.maxScale?this.maxScale:this.scale+this.stepScale;for(var i=0;i<this.scene.children.length;i++)if("Group"==this.scene.children[i].type)for(var e=0;e<this.scene.children[i].children.length;e++){this.scene.children[i].children[e].scale.set(this.scale/100,this.scale/100,this.scale/100)}this.calcCube.scale.set(0,0,0)}}},{key:"act_zoomOut",value:function(){if(this.scale>=this.minScale){this.scale;this.scale=this.scale<=this.minScale?this.minScale:this.scale-this.stepScale;for(var i=0;i<this.scene.children.length;i++)if("Group"==this.scene.children[i].type)for(var e=0;e<this.scene.children[i].children.length;e++){this.scene.children[i].children[e].scale.set(this.scale/100,this.scale/100,this.scale/100)}this.calcCube.scale.set(0,0,0)}}}]),e}()}}]);